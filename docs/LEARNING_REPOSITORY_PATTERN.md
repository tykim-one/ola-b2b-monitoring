# Repository Layer & DataSource ì¶”ìƒí™” í•™ìŠµ

## ëª©í‘œ
ë°±ì—”ë“œ ì•„í‚¤í…ì²˜ íŒ¨í„´ì„ ì´í•´í•˜ê³ , í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ì˜ DataSource ì¶”ìƒí™” êµ¬ì¡°ë¥¼ íŒŒì•…í•œë‹¤.

---

## í•™ìŠµ ì§„í–‰ ìƒíƒœ

- [x] Phase 1: í•µì‹¬ ê°œë… í•™ìŠµ
- [x] Phase 2: í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ ë¶„ì„
- [x] Phase 3: í™•ì¥ ë°©ë²• ì´í•´

---

## ìƒì„¸ ë¬¸ì„œ

| Phase | ë¬¸ì„œ | ë‚´ìš© |
|-------|------|------|
| 1.1 | [01-data-access-patterns.md](./learning/01-data-access-patterns.md) | Repository, DataSource, DAO, ORM íŒ¨í„´ ë¹„êµ |
| 1.2 | [02-nestjs-di-concepts.md](./learning/02-nestjs-di-concepts.md) | NestJS DI í•µì‹¬ (Module, Provider, Token) |
| 2.1 | [03-codebase-interface-analysis.md](./learning/03-codebase-interface-analysis.md) | MetricsDataSource ì¸í„°í˜ì´ìŠ¤ ë¶„ì„ |
| 2.2 | [04-codebase-factory-analysis.md](./learning/04-codebase-factory-analysis.md) | Factory íŒ¨í„´ ë¶„ì„ |
| 2.3 | [05-codebase-module-service.md](./learning/05-codebase-module-service.md) | Module & Service ì—°ê²° ë¶„ì„ |
| 3 | [06-extension-guide.md](./learning/06-extension-guide.md) | ìƒˆ DataSource ì¶”ê°€ ê°€ì´ë“œ |
| ì¶”ê°€ | [07-domain-based-aggregation.md](./learning/07-domain-based-aggregation.md) | ë„ë©”ì¸ë³„ ë°ì´í„° ì§‘ê³„ ì„¤ê³„ |

---

## ğŸš€ êµ¬í˜„ ê³„íš

**[IMPLEMENTATION_PLAN_DATASOURCE.md](./IMPLEMENTATION_PLAN_DATASOURCE.md)** - ì „ì²´ êµ¬í˜„ ê³„íš ë° ë‹¨ê³„ë³„ ê°€ì´ë“œ

---

## í•µì‹¬ ìš”ì•½

### ì•„í‚¤í…ì²˜ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Controller Layer                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Service Layer                           â”‚
â”‚  - ìºì‹± ì ìš©                                                â”‚
â”‚  - DataSourceì—ê²Œ ìœ„ì„                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ @Inject(METRICS_DATASOURCE)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DataSource Interface                      â”‚
â”‚  - 28ê°œ ë©”ì„œë“œ ì •ì˜ (ê³„ì•½)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ implements
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     êµ¬í˜„ì²´ë“¤                                â”‚
â”‚  BigQuery / PostgreSQL / MySQL / ...                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ íŒŒì¼

| íŒŒì¼ | ì—­í•  |
|------|------|
| `interfaces/metrics-datasource.interface.ts` | ê³„ì•½ ì •ì˜ + Injection Token |
| `implementations/bigquery-metrics.datasource.ts` | BigQuery êµ¬í˜„ |
| `factory/datasource.factory.ts` | ì¸ìŠ¤í„´ìŠ¤ ìƒì„±/ìºì‹± |
| `datasource.module.ts` | NestJS DI ì„¤ì • |

### ì„¤ê³„ ì›ì¹™

| ì›ì¹™ | ì ìš© |
|------|------|
| **OCP** (Open-Closed) | ìƒˆ êµ¬í˜„ì²´ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš” |
| **DIP** (Dependency Inversion) | Serviceê°€ Interfaceì—ë§Œ ì˜ì¡´ |
| **SRP** (Single Responsibility) | FactoryëŠ” ìƒì„±ë§Œ, ServiceëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ë§Œ |

### ìƒˆ DataSource ì¶”ê°€ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] êµ¬í˜„ì²´ íŒŒì¼ ìƒì„± (`implementations/xxx-metrics.datasource.ts`)
- [ ] 28ê°œ ë©”ì„œë“œ + 3ê°œ Lifecycle ë©”ì„œë“œ êµ¬í˜„
- [ ] Factoryì— switch case ì¶”ê°€
- [ ] ì„¤ì • íŒŒì¼ì— í”„ë¡œì íŠ¸ ì¶”ê°€

---

## í•™ìŠµ í‚¤ì›Œë“œ

- **Dependency Injection**: ì˜ì¡´ì„±ì„ ì™¸ë¶€ì—ì„œ ì£¼ì…
- **Interface**: êµ¬í˜„ì²´ê°€ ì§€ì¼œì•¼ í•  ê³„ì•½
- **Injection Token**: ëŸ°íƒ€ì„ ì‹ë³„ì (Symbol)
- **Factory Pattern**: ê°ì²´ ìƒì„± ë¡œì§ ìº¡ìŠí™”
- **useFactory**: NestJS ë¹„ë™ê¸° Provider ìƒì„±
- **Discriminated Union**: type í•„ë“œë¡œ íƒ€ì… êµ¬ë¶„
